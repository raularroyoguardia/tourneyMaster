<p-toast />
<header class="sticky top-0 z-50 backdrop-blur-md border-b border-slate-800">
  <div class="container mx-auto px-4 py-4 flex items-center justify-between">
    <!-- Logo y título -->
    <div class="flex items-center gap-3">
      <div class="logo-container">
        <img [src]="BaseUrl + '/uploads/logo/logo.png'" class="logo" alt="TourneyMaster Logo" />
      </div>
      <span class="site-title">TourneyMaster</span>
    </div>

    <!-- Mobile menu button -->
    <button class="mobile-menu-button md:hidden" (click)="toggleMobileMenu()">
      <i class="fi" [ngClass]="isMobileMenuOpen ? 'fi-rr-cross' : 'fi-rr-menu-burger'"></i>
    </button>

    <!-- Navbar centrado - Desktop -->
    <ng-container *ngIf="tokenService.isAuthenticated()">
      <nav class="hidden md:flex items-center gap-8">
        <a routerLink="/welcome" routerLinkActive="nav-active" [routerLinkActiveOptions]="{ exact: true }"
          class="nav-link"><span>Inici</span></a>
        <a routerLink="/torneig-list" routerLinkActive="nav-active" class="nav-link"><span>Tornejos</span></a>
        <a routerLink="/clasificacio-list" routerLinkActive="nav-active" class="nav-link"><span>Classificació</span></a>
        <a routerLink="/equip-list" routerLinkActive="nav-active" class="nav-link"><span>Equip</span></a>
      </nav>
    </ng-container>

    <ng-container *ngIf="!tokenService.isAuthenticated()">
      <nav class="hidden md:flex items-center gap-8">
        <a routerLink="/welcome" routerLinkActive="nav-active" [routerLinkActiveOptions]="{ exact: true }"
          class="nav-link"><span>Inici</span></a>
        <a routerLink="/torneig-list" class="nav-link-locked"><span>Tornejos</span><i
            class="fi fi-rr-lock lock-icon"></i></a>
        <a routerLink="/clasificacio-list" class="nav-link-locked"><span>Classificació</span><i
            class="fi fi-rr-lock lock-icon"></i></a>
        <a routerLink="/equip-list" class="nav-link-locked"><span>Equip</span><i
            class="fi fi-rr-lock lock-icon"></i></a>
      </nav>
    </ng-container>

    <!-- Botones usuario - Desktop -->
    <ng-container *ngIf="!tokenService.isAuthenticated()">
      <div class="hidden md:flex items-center gap-4">
        <a routerLink="/signup" class="auth-button">Registrar-se</a>
        <a routerLink="/login" class="auth-button">Iniciar Sessió</a>
      </div>
    </ng-container>

    <ng-container *ngIf="tokenService.isAuthenticated()">
      <div class="hidden md:flex items-center gap-4">
        <div class="trophy-badge">
          <span>{{ trofeus }}</span>
          <i class="fi fi-sr-trophy-star trophy-icon"></i>
        </div>
        <span class="username">{{ tokenService.getUserName() }}</span>
        <div class="profile-wrapper">
          <img [src]="BaseUrl + '/uploads/fotoUsuari/' + user.foto_perfil" class="profile-img"
            [alt]="user.name || 'Usuario'" (click)="toggleMenu()" />

          <!-- Submenú -->
          <div class="sub-menu-wrap" [ngClass]="{ 'menu-active': isMenuOpen }" id="subMenu">
            <div class="dropdown-content">
              <div class="user-info">
                <img [src]="BaseUrl + '/uploads/fotoUsuari/' + user.foto_perfil">
                <h3>{{ tokenService.getFullName() }}</h3>
              </div>
              <div class="menu-divider"></div>
              <a routerLink="/user-edit" class="menu-item">
                <div class="item-icon"><img src="/uploads/iconos/usuario.png" /></div>
                <p>Editar Compte</p>
                <span class="item-arrow">›</span>
              </a>
              <a routerLink="/user-list" class="menu-item" *ngIf="tipusUsuariId === 1">
                <div class="item-icon"><img src="/uploads/iconos/ajustes.png" /></div>
                <p>Gestionar Usuaris</p>
                <span class="item-arrow">›</span>
              </a>
              <a routerLink="/torneig-new" class="menu-item" *ngIf="tipusUsuariId === 1">
                <div class="item-icon"><img src="/uploads/iconos/podio-de-clasificacion.png" /></div>
                <p>Crear Torneig</p>
                <span class="item-arrow">›</span>
              </a>
              <a routerLink="/equip-new" class="menu-item" *ngIf="trofeus >= 1000 && canCreateTeam">
                <div class="item-icon"><img src="/uploads/iconos/seguidores.png" /></div>
                <p>Crear Equip</p>
                <span class="item-arrow">›</span>
              </a>
              <a (click)="toogleParametersDropdown()" class="menu-item" *ngIf="user.tipus_usuari_id === 1">
                <div class="item-icon"><img src="/uploads/iconos/seguidores.png" /></div>
                <p>Paràmetres</p>
                <span class="item-arrow">›</span>
              </a>

              <!-- Submenú desplegable de Paràmetres -->
              <div *ngIf="isParametersMenuOpen" class="dropdown-submenu">
                <div class="submenu-header">
                  <span>Paràmetres</span>
                </div>
                <a routerLink="/joc-new" class="submenu-item">
                  <div class="submenu-icon">
                    <i class="fi fi-rr-gamepad"></i>
                  </div>
                  <span>Joc</span>
                </a>
                <a routerLink="/mode-joc-new" class="submenu-item">
                  <div class="submenu-icon">
                    <i class="fi fi-rr-settings-sliders"></i>
                  </div>
                  <span>Mode de Joc</span>
                </a>
                <a routerLink="/mapa-new" class="submenu-item">
                  <div class="submenu-icon">
                    <i class="fi fi-rr-map-marker"></i>
                  </div>
                  <span>Mapa</span>
                </a>
              </div>

              <a (click)="logout()" class="menu-item logout-item">
                <div class="item-icon logout-icon"><img src="/uploads/iconos/energia-red.png" /></div>
                <p>Tancar Sessió</p>
                <span class="item-arrow">›</span>
              </a>              
            </div>
          </div>
        </div>
      </div>
    </ng-container>
  </div>

  <!-- Mobile Menu -->
  <div class="mobile-menu md:hidden" [ngClass]="{ 'mobile-menu-active': isMobileMenuOpen }">
    <div class="container mx-auto px-4 py-4">
      <nav class="flex flex-col space-y-4 mb-6">
        <a routerLink="/welcome" routerLinkActive="mobile-nav-active" [routerLinkActiveOptions]="{ exact: true }"
          class="mobile-nav-link" (click)="isMobileMenuOpen = false">Inici</a>
        <ng-container *ngIf="tokenService.isAuthenticated()">
          <a routerLink="/torneig-list" routerLinkActive="mobile-nav-active" class="mobile-nav-link"
            (click)="isMobileMenuOpen = false">Tornejos</a>
          <a routerLink="/clasificacio-list" routerLinkActive="mobile-nav-active" class="mobile-nav-link"
            (click)="isMobileMenuOpen = false">Classificació</a>
          <a routerLink="/equip-list" routerLinkActive="mobile-nav-active" class="mobile-nav-link"
            (click)="isMobileMenuOpen = false">Equip</a>
        </ng-container>

        <ng-container *ngIf="!tokenService.isAuthenticated()">
          <div class="mobile-nav-locked">
            <a routerLink="/torneig-list">Tornejos</a>
            <i class="fi fi-rr-lock"></i>
          </div>
          <div class="mobile-nav-locked">
            <a routerLink="/clasificacio-list">Classificació</a>
            <i class="fi fi-rr-lock"></i>
          </div>
          <div class="mobile-nav-locked">
            <a routerLink="/equip-list">Equip</a>
            <i class="fi fi-rr-lock"></i>
          </div>
        </ng-container>
      </nav>

      <ng-container *ngIf="tokenService.isAuthenticated()">
        <div class="mobile-user-section">
          <div class="mobile-user-header">
            <div class="mobile-user-info">
              <img [src]="BaseUrl + '/uploads/fotoUsuari/' + user.foto_perfil" class="mobile-user-img"
                [alt]="user.name || 'Usuario'">
              <span class="mobile-username">{{ tokenService.getUserName() }}</span>
            </div>
            <div class="mobile-trophy-badge">
              <span>{{ trofeus }}</span>
              <i class="fi fi-sr-trophy-star"></i>
            </div>
          </div>

          <div class="mobile-menu-items">
            <a routerLink="/user-edit" class="mobile-menu-item" (click)="isMobileMenuOpen = false">
              <span>Editar Compte</span>
              <i class="fi fi-rr-angle-right"></i>
            </a>
            <a routerLink="/user-list" class="mobile-menu-item" *ngIf="tipusUsuariId === 1"
              (click)="isMobileMenuOpen = false">
              <span>Gestionar Usuaris</span>
              <i class="fi fi-rr-angle-right"></i>
            </a>
            <a routerLink="/torneig-new" class="mobile-menu-item" *ngIf="tipusUsuariId === 1"
              (click)="isMobileMenuOpen = false">
              <span>Crear Torneig</span>
              <i class="fi fi-rr-angle-right"></i>
            </a>
            <a routerLink="/equip-new" class="mobile-menu-item" *ngIf="trofeus >= 1000 && canCreateTeam"
              (click)="isMobileMenuOpen = false">
              <span>Crear Equip</span>
              <i class="fi fi-rr-angle-right"></i>
            </a>
            <a (click)="toogleParametersDropdown()" class="mobile-menu-item" *ngIf="user.tipus_usuari_id === 1">
              <span>Paràmetres</span>
              <i class="fi fi-rr-angle-right"></i>
            </a>

            <!-- Submenú desplegable de Paràmetres -->
            <div *ngIf="isParametersMenuOpen" class="dropdown-submenu">
              <div class="submenu-header">
                <span>Paràmetres</span>
              </div>
              <a routerLink="/joc-new" class="submenu-item">
                <div class="submenu-icon">
                  <i class="fi fi-rr-gamepad"></i>
                </div>
                <span>Joc</span>
              </a>
              <a routerLink="/mode-joc-new" class="submenu-item">
                <div class="submenu-icon">
                  <i class="fi fi-rr-settings-sliders"></i>
                </div>
                <span>Mode de Joc</span>
              </a>
              <a routerLink="/mapa-new" class="submenu-item">
                <div class="submenu-icon">
                  <i class="fi fi-rr-map-marker"></i>
                </div>
                <span>Mapa</span>
              </a>
            </div>
            <a (click)="logout()" class="mobile-menu-item mobile-logout-item">
              <span>Tancar Sessió</span>
              <i class="fi fi-rr-angle-right"></i>
            </a>
          </div>
        </div>
      </ng-container>

      <ng-container *ngIf="!tokenService.isAuthenticated()">
        <div class="mobile-auth-buttons">
          <a routerLink="/signup" class="mobile-auth-button" (click)="isMobileMenuOpen = false">Registrar-se</a>
          <a routerLink="/login" class="mobile-auth-button" (click)="isMobileMenuOpen = false">Iniciar Sessió</a>
        </div>
      </ng-container>
    </div>
  </div>
</header>